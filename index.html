<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pok√©dex de cartes</title>

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }

body {
  margin: 0;
  background: #0b0b0b;
  color: white;
}

/* ===== OUVERTURE ===== */
#pokedex {
  max-width: 1400px;
  margin: 20px auto;
  background: #c62828;
  border-radius: 18px;
  padding: 18px;
  animation: openDex 1.0s ease-out;
}

@keyframes openDex {
  from { transform: translateX(-60px) scaleX(0.9); opacity: 0; }
  to { transform: translateX(0) scaleX(1); opacity: 1; }
}

/* ===== HEADER ===== */
header {
  display: flex;
  align-items: center;
  gap: 12px;
}

header h1 {
  flex: 1;
  margin: 0;
  font-size: 26px;
}

.led { border-radius: 50%; }
.led.big {
  width: 42px;
  height: 42px;
  background: radial-gradient(circle, #00e5ff, #01579b);
  border: 3px solid white;
}
.led.small { width: 12px; height: 12px; }
.red { background: #f44336; }
.yellow { background: #ffeb3b; }
.green { background: #4caf50; }

#counter, #rareCounter {
  background: #111;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 14px;
  color: #00e676;
}

/* ===== LAYOUT ===== */
#content {
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: 18px;
  margin-top: 18px;
}

/* ===== CONTROLS ===== */
#controls {
  background: #b71c1c;
  border-radius: 14px;
  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

#search, select {
  padding: 8px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
}

.toggle { font-size: 14px; }

/* ===== GEN STATS ===== */
.gen-stats {
  background: #111;
  border-radius: 8px;
  padding: 8px;
  font-size: 13px;
  line-height: 1.4;
}

/* ===== SCREEN ===== */
#screen {
  background: #263238;
  border-radius: 14px;
  padding: 14px;
  box-shadow: inset 0 0 14px black;
}

/* ===== GRID ===== */
#grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 14px;
}

.card {
  background: #37474f;
  border-radius: 8px;
  padding: 6px;
  text-align: center;
  position: relative;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card.has-card:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0,0,0,0.6);
  cursor: pointer;
}

.card img {
  width: 100%;
  border-radius: 6px;
}

.card.missing { opacity: 0.3; }

.name {
  font-size: 13px;
  margin-top: 4px;
}

/* ===== FAVORI ===== */
.star {
  position: absolute;
  top: 6px;
  right: 6px;
  font-size: 16px;
  cursor: pointer;
  opacity: 0.7;
}
.star.active {
  opacity: 1;
  color: gold;
}

/* ===== RARE ===== */
.diamond {
  position: absolute;
  top: 6px;
  left: 6px;
  font-size: 16px;
  cursor: pointer;
  opacity: 0.7;
}

.diamond.active {
  opacity: 1;
  color: #4fc3ff;
}

/* ===== LIST VIEW ===== */
#list {
  display: none;
  flex-direction: column;
  gap: 6px;
}

.list-item {
  background: #37474f;
  padding: 8px;
  border-radius: 6px;
  font-size: 14px;
  display: flex;
  justify-content: space-between;
}

.list-item.missing { opacity: 0.3; }

/* ===== VIEWER ===== */
#viewer {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 30;
}

#viewerContent {
  position: relative;
  text-align: center;
}

#viewer img {
  max-width: 90vw;
  max-height: 80vh;
  animation: zoomIn 0.25s ease;
}

@keyframes zoomIn {
  from { transform: scale(0.9); }
  to { transform: scale(1); }
}

#viewerInfo {
  margin-top: 10px;
  font-size: 18px;
}

/* NAV BUTTONS */
.nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 48px;
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  opacity: 0.7;
  z-index: 5;
}
.nav:hover { opacity: 1; }
.prev { left: -70px; }
.next { right: -70px; }

@media (max-width: 900px) {
  #content { grid-template-columns: 1fr; }
  .prev { left: 10px; }
  .next { right: 10px; }
}

/* ===== PROGRESS BARS ===== */
.progress {
  width: 100%;
  height: 8px;
  background: #333;
  border-radius: 4px;
  overflow: hidden;
  margin: 4px 0 8px;
}

.progress span {
  display: block;
  height: 100%;
  background: linear-gradient(90deg, #00e676, #00c853);
  width: 0%;
  transition: width 0.4s ease;
}

#counter {
  display: none;
}

</style>
</head>

<body>

<div id="pokedex">

<header>
  <div class="led big"></div>
  <div class="led small red"></div>
  <div class="led small yellow"></div>
  <div class="led small green"></div>
  <h1>Pok√©dex de cartes</h1>

  <div id="counter">0 / 0</div>
  <div id="rareCounter">0 / 1025 rares</div>
</header>

<div id="content">

<aside id="controls">
  <input type="text" id="search" placeholder="Nom ou num√©ro">

  <select id="genFilter">
    <option value="all">Toutes g√©n√©rations</option>
    <option value="1">G√©n√©ration 1</option>
    <option value="2">G√©n√©ration 2</option>
    <option value="3">G√©n√©ration 3</option>
    <option value="4">G√©n√©ration 4</option>
    <option value="5">G√©n√©ration 5</option>
    <option value="6">G√©n√©ration 6</option>
    <option value="7">G√©n√©ration 7</option>
    <option value="8">G√©n√©ration 8</option>
    <option value="9">G√©n√©ration 9</option>
  </select>

  <label class="toggle"><input type="checkbox" id="onlyMissing"> Sans carte</label>
  <label class="toggle"><input type="checkbox" id="onlyFav"> Favoris ‚≠ê</label>
  <label class="toggle"><input type="checkbox" id="onlyRare"> Cartes rares üíé</label>
  <label class="toggle"><input type="checkbox" id="listView"> Vue liste</label>

  <div class="gen-stats" id="genStats"></div>
</aside>

<main id="screen">
  <div id="grid"></div>
  <div id="list"></div>
</main>

</div>
</div>

<!-- ===== VIEWER ===== -->
<div id="viewer">
  <button class="nav prev">‚óÄ</button>

  <div id="viewerContent">
    <img id="viewerImg">
    <div id="viewerInfo"></div>
  </div>

  <button class="nav next">‚ñ∂</button>
</div>

<script src="data.js"></script>

<script>
const grid = document.getElementById("grid");
const list = document.getElementById("list");
const search = document.getElementById("search");
const onlyMissing = document.getElementById("onlyMissing");
const onlyFav = document.getElementById("onlyFav");
const onlyRare = document.getElementById("onlyRare");
const listView = document.getElementById("listView");
const genFilter = document.getElementById("genFilter");
const counter = document.getElementById("counter");
const rareCounter = document.getElementById("rareCounter");
const genStats = document.getElementById("genStats");

const viewer = document.getElementById("viewer");
const viewerImg = document.getElementById("viewerImg");
const viewerInfo = document.getElementById("viewerInfo");

// Listes partagees dans le code: elles sont utilisees comme base par defaut.
// Remplacez les ids ci-dessous par vos vraies cartes favorites/rares.
const DEFAULT_FAVORITES = [202,310,317,659,661,671];
const DEFAULT_RARES = [1,3,6,9,10,25,24,34,35,40,52,68,93,94,115,121,130,133,143,145,149,150,157,162,166,169,192,199,205,212,213,220,229,230,242,249,250,257,262,269,272,275,292,308,309,310,316,323,334,352,361,369,374,373,376,380,389,395,407,429,445,448,460,469,479,490,494,496,497,530,531,544,549,547,550,561,565,566,568,574,575,576,579,593,595,599,601,618,619,620,626,628,635,636,641,642,643,644,646,647,648,649,658,666,671,693,706,701,715,719,724,727,741,743,750,760,778,787,809,826,849,861,862,863,875,880,877,899,900,905,906,911,919,923,925,931,935,936,939,949,966,972,970,975,976,979,982,983,995,998,1007,1008,1014,1015,1011,1009,1016,1019,184,359,918,1005,51,777];

function readStoredIds(key, fallback) {
  try {
    const saved = JSON.parse(localStorage.getItem(key) || "null");
    if (Array.isArray(saved)) return saved;
  } catch (_) {}
  return [...fallback];
}

const favorites = readStoredIds("favorites", DEFAULT_FAVORITES);
const rares = readStoredIds("rares", DEFAULT_RARES);

let owned = 0;
let cards = [];
let currentIndex = -1;
let genOwned = Array(10).fill(0);
const genTotal = [0,151,100,135,107,156,72,88,96,120];

function getGen(id) {
  return id <= 151 ? 1 : id <= 251 ? 2 : id <= 386 ? 3 :
         id <= 493 ? 4 : id <= 649 ? 5 : id <= 721 ? 6 :
         id <= 809 ? 7 : id <= 905 ? 8 : 9;
}

pokedex.forEach(p => {
  const idStr = String(p.id).padStart(4, "0");
  const imgPath = `cards/${idStr}.png`;
  const gen = getGen(p.id);

  const card = document.createElement("div");
  card.className = "card";
  card.dataset.name = p.name;
  card.dataset.id = p.id;
  card.dataset.gen = gen;
  card.dataset.missing = "true";
  card.dataset.fav = favorites.includes(p.id);
  card.dataset.rare = rares.includes(p.id);

  const img = document.createElement("img");
  img.src = imgPath;

  img.onload = () => {
    card.dataset.missing = "false";
    card.classList.add("has-card");
    owned++;
    genOwned[gen]++;
    updateCounters();
  };

  img.onerror = () => card.classList.add("missing");

  const name = document.createElement("div");
  name.className = "name";
  name.textContent = `#${idStr} ${p.name}`;

  const star = document.createElement("div");
  star.className = "star";
  star.textContent = favorites.includes(p.id) ? "‚≠ê" : "‚òÜ";
  if (favorites.includes(p.id)) star.classList.add("active");

  star.onclick = e => {
    e.stopPropagation();
    toggleFav(p.id, star, card);
  };

  const diamond = document.createElement("div");
  diamond.className = "diamond";
  diamond.textContent = rares.includes(p.id) ? "üíé" : "‚óá";
  if (rares.includes(p.id)) diamond.classList.add("active");

  diamond.onclick = e => {
    e.stopPropagation();
    toggleRare(p.id, diamond, card);
  };

  card.onclick = () => {
    if (card.dataset.missing === "false") {
      currentIndex = cards.indexOf(card);
      openViewer();
    }
  };

  card.append(img, star, diamond, name);
  grid.appendChild(card);
  cards.push(card);
});

/* ===== FAVORIS ===== */
function toggleFav(id, star, card) {
  const i = favorites.indexOf(id);
  if (i === -1) {
    favorites.push(id);
    star.textContent = "‚≠ê";
    star.classList.add("active");
    card.dataset.fav = "true";
  } else {
    favorites.splice(i, 1);
    star.textContent = "‚òÜ";
    star.classList.remove("active");
    card.dataset.fav = "false";
  }
  localStorage.setItem("favorites", JSON.stringify(favorites));
  applyFilters();
}

/* ===== RARES ===== */
function toggleRare(id, diamond, card) {
  const i = rares.indexOf(id);
  if (i === -1) {
    rares.push(id);
    diamond.textContent = "üíé";
    diamond.classList.add("active");
    card.dataset.rare = "true";
  } else {
    rares.splice(i, 1);
    diamond.textContent = "‚óá";
    diamond.classList.remove("active");
    card.dataset.rare = "false";
  }
  localStorage.setItem("rares", JSON.stringify(rares));
  updateRareCounter();
  applyFilters();
}

function updateRareCounter() {
  rareCounter.textContent = `${rares.length} / 1025 cartes rares`;
}

/* ===== VIEWER ===== */
function openViewer() {
  updateViewer();
  viewer.style.display = "flex";
}

function updateViewer() {
  const card = cards[currentIndex];
  const idStr = String(card.dataset.id).padStart(4, "0");
  viewerImg.src = `cards/${idStr}.png`;
  viewerInfo.textContent = `#${idStr} ${card.dataset.name}`;
}

function navigate(dir) {
  let i = currentIndex;
  while (true) {
    i += dir;
    if (i < 0 || i >= cards.length) return;
    if (cards[i].dataset.missing === "false") {
      currentIndex = i;
      updateViewer();
      return;
    }
  }
}

document.querySelector(".prev").onclick = e => { e.stopPropagation(); navigate(-1); };
document.querySelector(".next").onclick = e => { e.stopPropagation(); navigate(1); };

viewer.onclick = () => viewer.style.display = "none";

/* ===== SWIPE MOBILE ===== */
let startX = 0;
viewer.addEventListener("touchstart", e => startX = e.touches[0].clientX);
viewer.addEventListener("touchend", e => {
  const dx = e.changedTouches[0].clientX - startX;
  if (Math.abs(dx) > 50) navigate(dx < 0 ? 1 : -1);
});

/* ===== CLAVIER ===== */
document.addEventListener("keydown", e => {
  if (viewer.style.display !== "flex") return;
  if (e.key === "ArrowLeft") navigate(-1);
  if (e.key === "ArrowRight") navigate(1);
  if (e.key === "Escape") viewer.style.display = "none";
});

/* ===== FILTERS & COUNTERS ===== */
function updateCounters() {
  counter.textContent = `${owned} / ${pokedex.length}`;

  const globalPercent = Math.round((owned / pokedex.length) * 100);

  let html = `
    <strong>Global</strong>
    <div class="progress">
      <span style="width:${globalPercent}%"></span>
    </div>
    ${owned} / ${pokedex.length}
    <hr style="border:0;border-top:1px solid #333;margin:8px 0">
  `;

  for (let g = 1; g <= 9; g++) {
    const percent = Math.round((genOwned[g] / genTotal[g]) * 100);
    html += `
      <strong>G${g}</strong> : ${genOwned[g]} / ${genTotal[g]}
      <div class="progress">
        <span style="width:${percent}%"></span>
      </div>
    `;
  }

  genStats.innerHTML = html;
  updateRareCounter();
}

function applyFilters() {
  const s = search.value.toLowerCase();
  const gen = genFilter.value;

  grid.style.display = listView.checked ? "none" : "grid";
  list.style.display = listView.checked ? "flex" : "none";
  list.innerHTML = "";

  cards.forEach(c => {
    const ok =
      (c.dataset.name.toLowerCase().includes(s) || c.dataset.id.startsWith(s)) &&
      (!onlyMissing.checked || c.dataset.missing === "true") &&
      (!onlyFav.checked || c.dataset.fav === "true") &&
      (!onlyRare.checked || c.dataset.rare === "true") &&
      (gen === "all" || c.dataset.gen === gen);

    c.style.display = ok && !listView.checked ? "" : "none";

    if (ok && listView.checked) {
      const li = document.createElement("div");
      li.className = "list-item" + (c.dataset.missing === "true" ? " missing" : "");
      li.textContent = `#${String(c.dataset.id).padStart(4,"0")} ${c.dataset.name}`;
      list.appendChild(li);
    }
  });
}

[search, onlyMissing, onlyFav, onlyRare, listView, genFilter]
  .forEach(el => el.addEventListener("change", applyFilters));

updateCounters();
</script>

</body>
</html>
