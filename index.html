<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokédex de cartes</title>

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }

body {
  margin: 0;
  background: #0b0b0b;
  color: white;
}

/* ===== OUVERTURE ===== */
#pokedex {
  max-width: 1400px;
  margin: 20px auto;
  background: #c62828;
  border-radius: 18px;
  padding: 18px;
  animation: openDex 0.8s ease-out;
}

@keyframes openDex {
  from { transform: translateX(-60px) scaleX(0.9); opacity: 0; }
  to { transform: translateX(0) scaleX(1); opacity: 1; }
}

/* ===== HEADER ===== */
header {
  display: flex;
  align-items: center;
  gap: 12px;
}

header h1 {
  flex: 1;
  margin: 0;
  font-size: 26px;
}

.led { border-radius: 50%; }
.led.big {
  width: 42px;
  height: 42px;
  background: radial-gradient(circle, #00e5ff, #01579b);
  border: 3px solid white;
}
.led.small { width: 12px; height: 12px; }
.red { background: #f44336; }
.yellow { background: #ffeb3b; }
.green { background: #4caf50; }

#counter {
  background: #111;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 14px;
  color: #00e676;
}

/* ===== LAYOUT ===== */
#content {
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: 18px;
  margin-top: 18px;
}

/* ===== CONTROLS ===== */
#controls {
  background: #b71c1c;
  border-radius: 14px;
  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

#search, select {
  padding: 8px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
}

.toggle { font-size: 14px; }

/* ===== GEN STATS ===== */
.gen-stats {
  background: #111;
  border-radius: 8px;
  padding: 8px;
  font-size: 13px;
  line-height: 1.4;
}

/* ===== SCREEN ===== */
#screen {
  background: #263238;
  border-radius: 14px;
  padding: 14px;
  box-shadow: inset 0 0 14px black;
}

/* ===== GRID ===== */
#grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 14px;
}

.card {
  background: #37474f;
  border-radius: 8px;
  padding: 6px;
  text-align: center;
  position: relative;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card.has-card:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0,0,0,0.6);
  cursor: pointer;
}

.card img {
  width: 100%;
  border-radius: 6px;
}

.card.missing { opacity: 0.3; }

.name {
  font-size: 13px;
  margin-top: 4px;
}

/* ===== FAVORI ===== */
.star {
  position: absolute;
  top: 6px;
  right: 6px;
  font-size: 16px;
  cursor: pointer;
  opacity: 0.7;
}
.star.active {
  opacity: 1;
  color: gold;
}

/* ===== LIST VIEW ===== */
#list {
  display: none;
  flex-direction: column;
  gap: 6px;
}

.list-item {
  background: #37474f;
  padding: 8px;
  border-radius: 6px;
  font-size: 14px;
  display: flex;
  justify-content: space-between;
}

.list-item.missing { opacity: 0.3; }

/* ===== VIEWER ===== */
#viewer {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 30;
}

#viewerContent {
  position: relative;
  text-align: center;
}

#viewer img {
  max-width: 90vw;
  max-height: 80vh;
  animation: zoomIn 0.25s ease;
}

@keyframes zoomIn {
  from { transform: scale(0.9); }
  to { transform: scale(1); }
}

#viewerInfo {
  margin-top: 10px;
  font-size: 18px;
}

/* NAV BUTTONS */
.nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 48px;
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  opacity: 0.7;
}
.nav:hover { opacity: 1; }
.prev { left: -70px; }
.next { right: -70px; }

@media (max-width: 900px) {
  #content { grid-template-columns: 1fr; }
  .prev { left: 10px; }
  .next { right: 10px; }
}
</style>
</head>

<body>

<div id="pokedex">

<header>
  <div class="led big"></div>
  <div class="led small red"></div>
  <div class="led small yellow"></div>
  <div class="led small green"></div>
  <h1>Pokédex de cartes</h1>
  <div id="counter">0 / 0</div>
</header>

<div id="content">

<aside id="controls">
  <input type="text" id="search" placeholder="Nom ou numéro">

  <select id="genFilter">
    <option value="all">Toutes générations</option>
    <option value="1">Génération 1</option>
    <option value="2">Génération 2</option>
    <option value="3">Génération 3</option>
    <option value="4">Génération 4</option>
    <option value="5">Génération 5</option>
    <option value="6">Génération 6</option>
    <option value="7">Génération 7</option>
    <option value="8">Génération 8</option>
    <option value="9">Génération 9</option>
  </select>

  <label class="toggle"><input type="checkbox" id="onlyMissing"> Sans carte</label>
  <label class="toggle"><input type="checkbox" id="onlyFav"> Favoris ⭐</label>
  <label class="toggle"><input type="checkbox" id="listView"> Vue liste</label>

  <div class="gen-stats" id="genStats"></div>
</aside>

<main id="screen">
  <div id="grid"></div>
  <div id="list"></div>
</main>

</div>
</div>

<!-- ===== VIEWER ===== -->
<div id="viewer">
  <button class="nav prev">◀</button>

  <div id="viewerContent">
    <img id="viewerImg">
    <div id="viewerInfo"></div>
  </div>

  <button class="nav next">▶</button>
</div>

<script src="data.js"></script>

<script>
const grid = document.getElementById("grid");
const list = document.getElementById("list");
const search = document.getElementById("search");
const onlyMissing = document.getElementById("onlyMissing");
const onlyFav = document.getElementById("onlyFav");
const listView = document.getElementById("listView");
const genFilter = document.getElementById("genFilter");
const counter = document.getElementById("counter");
const genStats = document.getElementById("genStats");

const viewer = document.getElementById("viewer");
const viewerImg = document.getElementById("viewerImg");
const viewerInfo = document.getElementById("viewerInfo");

const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

let owned = 0;
let cards = [];
let currentIndex = -1;
let genOwned = Array(10).fill(0);
const genTotal = [0,151,100,135,107,156,72,88,96,120];

function getGen(id) {
  return id <= 151 ? 1 : id <= 251 ? 2 : id <= 386 ? 3 :
         id <= 493 ? 4 : id <= 649 ? 5 : id <= 721 ? 6 :
         id <= 809 ? 7 : id <= 905 ? 8 : 9;
}

pokedex.forEach(p => {
  const idStr = String(p.id).padStart(4, "0");
  const imgPath = `cards/${idStr}.png`;
  const gen = getGen(p.id);

  const card = document.createElement("div");
  card.className = "card";
  card.dataset.name = p.name;
  card.dataset.id = p.id;
  card.dataset.gen = gen;
  card.dataset.missing = "true";
  card.dataset.fav = favorites.includes(p.id);

  const img = document.createElement("img");
  img.src = imgPath;

  img.onload = () => {
    card.dataset.missing = "false";
    card.classList.add("has-card");
    owned++;
    genOwned[gen]++;
    updateCounters();
  };

  img.onerror = () => card.classList.add("missing");

  const name = document.createElement("div");
  name.className = "name";
  name.textContent = `#${idStr} ${p.name}`;

  const star = document.createElement("div");
  star.className = "star";
  star.textContent = favorites.includes(p.id) ? "⭐" : "☆";
  if (favorites.includes(p.id)) star.classList.add("active");

  star.onclick = e => {
    e.stopPropagation();
    toggleFav(p.id, star, card);
  };

  card.onclick = () => {
    if (card.dataset.missing === "false") {
      currentIndex = cards.indexOf(card);
      openViewer();
    }
  };

  card.append(img, star, name);
  grid.appendChild(card);
  cards.push(card);
});

/* ===== FAVORIS ===== */
function toggleFav(id, star, card) {
  const i = favorites.indexOf(id);
  if (i === -1) {
    favorites.push(id);
    star.textContent = "⭐";
    star.classList.add("active");
    card.dataset.fav = "true";
  } else {
    favorites.splice(i, 1);
    star.textContent = "☆";
    star.classList.remove("active");
    card.dataset.fav = "false";
  }
  localStorage.setItem("favorites", JSON.stringify(favorites));
  applyFilters();
}

/* ===== VIEWER ===== */
function openViewer() {
  updateViewer();
  viewer.style.display = "flex";
}

function updateViewer() {
  const card = cards[currentIndex];
  const idStr = String(card.dataset.id).padStart(4, "0");
  viewerImg.src = `cards/${idStr}.png`;
  viewerInfo.textContent = `#${idStr} ${card.dataset.name}`;
}

function navigate(dir) {
  let i = currentIndex;
  while (true) {
    i += dir;
    if (i < 0 || i >= cards.length) return;
    if (cards[i].dataset.missing === "false") {
      currentIndex = i;
      updateViewer();
      return;
    }
  }
}

document.querySelector(".prev").onclick = e => { e.stopPropagation(); navigate(-1); };
document.querySelector(".next").onclick = e => { e.stopPropagation(); navigate(1); };

viewer.onclick = () => viewer.style.display = "none";

/* ===== SWIPE MOBILE ===== */
let startX = 0;
viewer.addEventListener("touchstart", e => startX = e.touches[0].clientX);
viewer.addEventListener("touchend", e => {
  const dx = e.changedTouches[0].clientX - startX;
  if (Math.abs(dx) > 50) navigate(dx < 0 ? 1 : -1);
});

/* ===== CLAVIER ===== */
document.addEventListener("keydown", e => {
  if (viewer.style.display !== "flex") return;
  if (e.key === "ArrowLeft") navigate(-1);
  if (e.key === "ArrowRight") navigate(1);
  if (e.key === "Escape") viewer.style.display = "none";
});

/* ===== FILTERS ===== */
function updateCounters() {
  counter.textContent = `${owned} / ${pokedex.length}`;
  genStats.innerHTML = genOwned.slice(1).map(
    (v,i)=>`G${i+1} : ${v} / ${genTotal[i+1]}`
  ).join("<br>");
}

function applyFilters() {
  const s = search.value.toLowerCase();
  const gen = genFilter.value;

  grid.style.display = listView.checked ? "none" : "grid";
  list.style.display = listView.checked ? "flex" : "none";
  list.innerHTML = "";

  cards.forEach(c => {
    const ok =
      (c.dataset.name.toLowerCase().includes(s) || c.dataset.id.startsWith(s)) &&
      (!onlyMissing.checked || c.dataset.missing === "true") &&
      (!onlyFav.checked || c.dataset.fav === "true") &&
      (gen === "all" || c.dataset.gen === gen);

    c.style.display = ok && !listView.checked ? "" : "none";

    if (ok && listView.checked) {
      const li = document.createElement("div");
      li.className = "list-item" + (c.dataset.missing === "true" ? " missing" : "");
      li.textContent = `#${String(c.dataset.id).padStart(4,"0")} ${c.dataset.name}`;
      list.appendChild(li);
    }
  });
}

[search, onlyMissing, onlyFav, listView, genFilter]
  .forEach(el => el.addEventListener("change", applyFilters));

updateCounters();
</script>

</body>
</html>
